# Hysteria2 配置管理脚本

一个用于简化 Hysteria2 服务器配置和管理的交互式脚本工具。

## 功能特性

- 🚀 **一键安装/卸载** Hysteria2 服务器
- ⚙️ **智能配置生成** 支持 ACME 自动证书和自签名证书
- 🌐 **服务器域名管理** 配置和验证服务器域名解析
- 🔧 **智能端口跳跃** 配置后自动检测和管理端口跳跃状态
- 📊 **智能服务管理** 配置后询问是否立即重启服务
- 📱 **多客户端支持** 生成适配不同客户端的订阅链接
- 🛠️ **配置管理** 图形化修改配置参数或直接编辑配置文件

## 快速开始

### 一键安装

```bash
# 一键安装到服务器
curl -fsSL https://raw.githubusercontent.com/sindricn/s-hy2/main/quick-install.sh | sudo bash

# 运行脚本
sudo s-hy2
```

### 手动安装

```bash
# 下载脚本
wget https://raw.githubusercontent.com/sindricn/s-hy2/main/hy2-manager.sh

# 添加执行权限
chmod +x hy2-manager.sh

# 运行脚本
sudo ./hy2-manager.sh
```

## 使用说明

运行脚本后会显示交互式菜单，包含以下选项：

1. **安装 Hysteria2** - 自动下载并安装 Hysteria2 服务器
2. **快速配置** - 自动配置自签名证书+混淆+端口跳跃
3. **手动配置** - 交互式生成配置文件 (ACME/自签名)
4. **修改配置** - 修改认证密码、端口、混淆等配置参数
5. **域名管理** - 分别管理ACME域名和伪装域名
6. **证书管理** - 生成、上传、查看和管理SSL证书
7. **服务管理** - 启动/停止/重启/查看状态
8. **节点信息** - 显示节点链接、订阅链接和客户端配置
9. **查看日志** - 查看服务运行日志
10. **卸载服务** - 提供多种卸载选项
11. **关于脚本** - 查看脚本信息

## 配置模式

### 一键快速配置 (推荐新手)
- **自动化程度**: 完全自动化，无需手动输入
- **证书方案**: 自签名证书 (无需域名)
- **伪装域名**: 自动测试选择延迟最低的域名
- **安全特性**: 自动生成认证密码和混淆密码
- **网络优化**: 自动配置端口跳跃 (20000-50000)
- **适用场景**: 快速部署、测试环境、新手用户

### ACME 自动证书模式
- 自动申请和续期 SSL 证书
- 需要有效域名和邮箱
- 推荐用于生产环境

### 自签名证书模式
- 生成自签名证书
- 无需域名，快速部署
- 适合测试环境

## 新增功能特性

### 配置管理功能
- **查看当前配置** - 显示完整配置文件内容
- **修改认证密码** - 更改或生成新的认证密码
- **修改端口设置** - 更改服务监听端口
- **修改混淆设置** - 启用/禁用/修改混淆配置
- **打开配置文件编辑** - 使用文本编辑器直接修改配置

### 域名管理功能
- **ACME域名管理** - 设置用于申请SSL证书的域名
- **伪装域名管理** - 管理TLS握手的伪装域名
- **域名连通性测试** - 测试域名解析和连通性
- **自动测试最佳伪装域名** - 自动选择延迟最低的伪装域名

### 证书管理功能
- **生成自签名证书** - 为指定域名或IP生成自签名证书
- **上传自定义证书** - 上传和配置自有SSL证书
- **查看证书信息** - 显示证书详细信息和有效期
- **证书文件管理** - 管理证书文件路径和删除证书
- **自动配置更新** - 证书更改后自动更新配置文件

所有修改都会自动备份原配置文件，并可选择立即重启服务应用更改。

## 目录结构

```
s-hy2/
├── hy2-manager.sh          # 主脚本
├── quick-install.sh        # 一键安装脚本
├── install.sh              # 独立安装脚本
├── scripts/                # 功能脚本目录
│   ├── install.sh         # 安装脚本
│   ├── config.sh          # 配置生成脚本 (含一键快速配置)
│   ├── service.sh         # 服务管理脚本
│   ├── domain-test.sh     # 域名测试脚本
│   └── node-info.sh       # 节点信息脚本
├── templates/             # 配置模板目录
│   ├── acme-config.yaml   # ACME 配置模板
│   ├── self-cert-config.yaml # 自签名配置模板
│   └── client-config.yaml    # 客户端配置示例
└── README.md              # 说明文档
```

## 快捷命令

安装完成后，可以使用以下命令快速启动：

```bash
# 推荐使用 (简短易记)
sudo s-hy2

# 或者使用完整命令
sudo hy2-manager
```

## 系统要求

- Linux 系统 (Ubuntu/Debian/CentOS/RHEL/Fedora)
- Root 权限
- 网络连接
- 至少 100MB 可用空间

## 快速开始示例

### 完整部署流程
```bash
# 1. 一键安装
curl -fsSL https://raw.githubusercontent.com/sindricn/s-hy2/main/quick-install.sh | sudo bash

# 2. 启动脚本
sudo s-hy2

# 3. 按菜单操作
# 选择 1 -> 安装 Hysteria2
# 选择 2 -> 快速配置
# 选择 8 -> 查看节点信息
```

### 预期输出
```
=== Hysteria2 一键快速配置 ===

步骤 1/7: 获取服务器信息...
服务器IP: 192.168.1.100
网络接口: eth0

步骤 2/7: 测试最优伪装域名...
最优伪装域名: cdn.jsdelivr.net

步骤 3/7: 生成随机密码...
认证密码: Kx9mP2nQ8vR5wE7t
混淆密码: Hy6bN4jM1sL3xC9z

步骤 4/7: 生成自签名证书...
证书生成完成

步骤 5/7: 生成配置文件...
配置文件生成完成

步骤 6/7: 配置端口跳跃...
端口跳跃配置成功 (20000-50000 -> 443)

步骤 7/7: 启动服务...
服务启动成功!

=== 配置完成 ===
节点链接: hysteria2://Kx9mP2nQ8vR5wE7t@192.168.1.100:443?sni=cdn.jsdelivr.net&insecure=1&obfs=salamander&obfs-password=Hy6bN4jM1sL3xC9z#Hysteria2-QuickSetup
```

## 常见问题

### Q: 如何修改配置参数？
A: 运行 `sudo s-hy2`，选择菜单 "4. 修改配置"，可以图形化修改密码、端口、混淆等设置，或直接编辑配置文件。

### Q: 如何管理域名和证书？
A: 使用 "5. 域名管理" 分别管理ACME域名和伪装域名，使用 "6. 证书管理" 生成、上传和管理SSL证书。

### Q: 一键快速配置包含哪些功能？
A: 自动获取服务器IP、测试最优伪装域名、生成随机密码、创建自签名证书、配置混淆和端口跳跃、启动服务。

### Q: 如何获取节点连接信息？
A: 运行 `sudo s-hy2`，选择菜单 "8. 节点信息"，可查看节点链接、订阅链接和客户端配置。

### Q: 支持哪些操作系统？
A: Ubuntu 18.04+、Debian 9+、CentOS 7+、RHEL 7+、Fedora 30+。

### Q: 如何卸载？
A: 运行脚本选择 "10. 卸载服务"，提供多种卸载方式选择。

